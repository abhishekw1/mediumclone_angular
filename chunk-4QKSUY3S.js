import{$a as F,H as R,Ja as M,K as O,M as m,N as a,O as z,P as U,Ua as E,V as I,Va as b,Wa as j,Xa as v,Ya as C,_ as P,a as g,b as y,eb as c,fb as u,lb as q,tb as w,ub as D,vb as L}from"./chunk-2WJLTE3U.js";var V="@ngrx/router-store/request",ut=c(V,u()),N="@ngrx/router-store/navigation",lt=c(N,u()),S="@ngrx/router-store/cancel",ht=c(S,u()),A="@ngrx/router-store/error",ft=c(A,u()),_="@ngrx/router-store/navigated",dt=c(_,u());function pt(e,t){let o=t;switch(o.type){case N:case A:case S:return{state:o.payload.routerState,navigationId:o.payload.event.id};default:return e}}var h=class{serialize(t){return{root:this.serializeRoute(t.root),url:t.url}}serializeRoute(t){let o=t.children.map(i=>this.serializeRoute(i));return{params:t.params,data:t.data,url:t.url,outlet:t.outlet,title:t.title,routeConfig:t.routeConfig?{path:t.routeConfig.path,pathMatch:t.routeConfig.pathMatch,redirectTo:t.routeConfig.redirectTo,outlet:t.routeConfig.outlet,title:typeof t.routeConfig.title=="string"?t.routeConfig.title:void 0}:null,queryParams:t.queryParams,fragment:t.fragment,firstChild:o[0],children:o}}},T=function(e){return e[e.PreActivation=1]="PreActivation",e[e.PostActivation=2]="PostActivation",e}(T||{}),Q="router",x=new m("@ngrx/router-store Internal Configuration"),G=new m("@ngrx/router-store Configuration");function B(e){return g({stateKey:Q,serializer:h,navigationActionTiming:T.PreActivation},e)}var f=class{serialize(t){return{root:this.serializeRoute(t.root),url:t.url}}serializeRoute(t){let o=t.children.map(i=>this.serializeRoute(i));return{params:t.params,paramMap:t.paramMap,data:t.data,url:t.url,outlet:t.outlet,title:t.title,routeConfig:t.routeConfig?{component:t.routeConfig.component,path:t.routeConfig.path,pathMatch:t.routeConfig.pathMatch,redirectTo:t.routeConfig.redirectTo,outlet:t.routeConfig.outlet,title:t.routeConfig.title}:null,queryParams:t.queryParams,queryParamMap:t.queryParamMap,fragment:t.fragment,component:t.routeConfig?t.routeConfig.component:void 0,root:void 0,parent:void 0,firstChild:o[0],pathFromRoot:void 0,children:o}}},d=class{},n=function(e){return e[e.NONE=1]="NONE",e[e.ROUTER=2]="ROUTER",e[e.STORE=3]="STORE",e}(n||{}),k=(()=>{let t=class t{constructor(i,r,s,l,H,p){this.store=i,this.router=r,this.serializer=s,this.errorHandler=l,this.config=H,this.activeRuntimeChecks=p,this.lastEvent=null,this.routerState=null,this.trigger=n.NONE,this.stateKey=this.config.stateKey,!L()&&M()&&(p?.strictActionSerializability||p?.strictStateSerializability)&&this.serializer instanceof f&&console.warn("@ngrx/router-store: The serializability runtime checks cannot be enabled with the FullRouterStateSerializer. The FullRouterStateSerializer has an unserializable router state and actions that are not serializable. To use the serializability runtime checks either use the MinimalRouterStateSerializer or implement a custom router state serializer."),this.setUpStoreStateListener(),this.setUpRouterEventsListener()}setUpStoreStateListener(){this.store.pipe(D(this.stateKey),R(this.store)).subscribe(([i,r])=>{this.navigateIfNeeded(i,r)})}navigateIfNeeded(i,r){if(!i||!i.state||this.trigger===n.ROUTER||this.lastEvent instanceof E)return;let s=i.state.url;Z(this.router.url,s)||(this.storeState=r,this.trigger=n.STORE,this.router.navigateByUrl(s).catch(l=>{this.errorHandler.handleError(l)}))}setUpRouterEventsListener(){let i=this.config.navigationActionTiming===T.PostActivation,r;this.router.events.pipe(R(this.store)).subscribe(([s,l])=>{this.lastEvent=s,s instanceof E?(this.routerState=this.serializer.serialize(this.router.routerState.snapshot),this.trigger!==n.STORE&&(this.storeState=l,this.dispatchRouterRequest(s))):s instanceof C?(r=s,!i&&this.trigger!==n.STORE&&this.dispatchRouterNavigation(s)):s instanceof j?(this.dispatchRouterCancel(s),this.reset()):s instanceof v?(this.dispatchRouterError(s),this.reset()):s instanceof b&&(this.trigger!==n.STORE&&(i&&this.dispatchRouterNavigation(r),this.dispatchRouterNavigated(s)),this.reset())})}dispatchRouterRequest(i){this.dispatchRouterAction(V,{event:i})}dispatchRouterNavigation(i){let r=this.serializer.serialize(i.state);this.dispatchRouterAction(N,{routerState:r,event:new C(i.id,i.url,i.urlAfterRedirects,r)})}dispatchRouterCancel(i){this.dispatchRouterAction(S,{storeState:this.storeState,event:i})}dispatchRouterError(i){this.dispatchRouterAction(A,{storeState:this.storeState,event:new v(i.id,i.url,`${i}`)})}dispatchRouterNavigated(i){let r=this.serializer.serialize(this.router.routerState.snapshot);this.dispatchRouterAction(_,{event:i,routerState:r})}dispatchRouterAction(i,r){this.trigger=n.ROUTER;try{this.store.dispatch({type:i,payload:y(g({routerState:this.routerState},r),{event:this.config.routerState===0?r.event:{id:r.event.id,url:r.event.url,urlAfterRedirects:r.event.urlAfterRedirects}})})}finally{this.trigger=n.NONE}}reset(){this.trigger=n.NONE,this.storeState=null,this.routerState=null}};t.\u0275fac=function(r){return new(r||t)(a(w),a(F),a(d),a(P),a(G),a(q))},t.\u0275prov=O({token:t,factory:t.\u0275fac});let e=t;return e})();function Z(e,t){return K(e)===K(t)}function K(e){return e?.length>0&&e[e.length-1]==="/"?e.substring(0,e.length-1):e}function gt(e={}){return I([{provide:x,useValue:e},{provide:G,useFactory:B,deps:[x]},{provide:d,useClass:e.serializer?e.serializer:e.routerState===0?f:h},{provide:U,multi:!0,useFactory(){return()=>z(k)}},k])}export{lt as a,dt as b,pt as c,gt as d};
